<!-- Comments overlay -->
<div
        x-cloak
        x-show="commentsOpen"
        x-transition
        class="fixed inset-0 bg-black/70 flex items-end justify-center z-50"
        @keydown.escape.window="closeComments()"
>
    <div class="bg-white text-black w-full max-w-xl h-3/4 rounded-t-xl overflow-hidden flex flex-col">
        <div class="flex items-center justify-between px-4 py-3 border-b">
            <h3 class="font-semibold">Comments</h3>
            <button @click="closeComments()" class="text-lg px-3">✕</button>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-4">
            <template x-if="commentsLoading">
                <div class="space-y-2">
                    <div class="h-3 bg-gray-200 animate-pulse rounded w-1/2"></div>
                    <div class="h-3 bg-gray-200 animate-pulse rounded w-2/3"></div>
                </div>
            </template>

            <template x-for="comment in comments" :key="comment.id">
                <div class="flex items-start gap-3">
                    <img :src="comment.user.avatar" class="w-10 h-10 rounded-full object-cover"/>
                    <div>
                        <div class="text-sm font-semibold" x-text="comment.user.username"></div>
                        <div class="text-sm" x-text="comment.text"></div>
                        <div class="text-xs text-gray-500" x-text="comment.created_at"></div>
                    </div>
                </div>
            </template>

            <div x-show="!comments.length && !commentsLoading" class="text-center text-gray-500">
                No comments yet — be the first!
            </div>
        </div>

        <form {% if user.is_authenticated %}@submit.prevent="submitComment()" {% endif %}
              class="p-4 border-t flex gap-2">
            {% if user.is_authenticated %}
            <input
                    x-model="commentInput"
                    required
                    class="flex-1 rounded-full px-4 py-2 border"
                    placeholder="Add a comment..."
            />
            {% endif %}
            <button type="submit" class="bg-primary text-white px-4 py-2 rounded-full">
                {% if user.is_authenticated %}
                Send
                {% else %}
                Login to comment
                {% endif %}
            </button>
        </form>
    </div>
</div>